{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block extra_head %}
<style>
.hero-card {
  border: 0;
  border-radius: 18px;
  background: linear-gradient(135deg, rgba(13, 110, 253, 0.9), rgba(32, 201, 151, 0.85));
  color: #fff;
}
.hero-card .badge {
  background: rgba(255, 255, 255, 0.18);
  color: #fff;
}
.info-grid .card {
  border-radius: 16px;
}
.timeline-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background-color: #0d6efd;
  margin-right: 0.75rem;
}
</style>
{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-4">
  <div>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-2">
        <li class="breadcrumb-item"><a href="{% url 'vehiculos:list' %}">Vehiculos</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ vehiculo.placa }}</li>
      </ol>
    </nav>
    <h1 class="h3 mb-0">{{ vehiculo.marca|default:"Vehiculo" }} {{ vehiculo.modelo|default:"" }}</h1>
  </div>
  <div class="btn-group">
    <a class="btn btn-outline-secondary btn-sm" href="{% url 'vehiculos:list' %}">
      <i class="bi bi-arrow-left-short me-1"></i> Volver
    </a>
    {% if user.is_superuser or user.is_staff %}
      <a class="btn btn-outline-primary btn-sm" href="{% url 'vehiculos:update' vehiculo.pk %}">
        <i class="bi bi-pencil-square me-1"></i> Editar
      </a>
      <a class="btn btn-outline-danger btn-sm" href="{% url 'vehiculos:delete' vehiculo.pk %}">
        <i class="bi bi-trash3 me-1"></i> Eliminar
      </a>
    {% endif %}
  </div>
</div>

<div class="hero-card shadow-sm p-4 mb-4">
  <div class="row gy-3 align-items-center">
    <div class="col-md-6">
      <div class="d-flex align-items-center gap-3">
        <span class="display-6 fw-semibold text-uppercase mb-0">{{ vehiculo.placa }}</span>
        <span class="badge rounded-pill">
          {% if vehiculo.cliente %}
            {{ vehiculo.cliente.nombre }}
          {% else %}
            Sin cliente
          {% endif %}
        </span>
      </div>
      <div class="mt-3 d-flex flex-wrap gap-3">
        <span><i class="bi bi-buildings me-1"></i> {{ vehiculo.marca|default:"-" }}</span>
        <span><i class="bi bi-steam me-1"></i> {{ vehiculo.modelo|default:"-" }}</span>
        <span><i class="bi bi-calendar2-week me-1"></i> {{ vehiculo.anio|default:"-" }}</span>
      </div>
    </div>
    <div class="col-md-6 text-md-end">
      <div class="d-flex flex-column flex-md-row justify-content-end gap-2">
        <a class="btn btn-light btn-sm" href="{% url 'citas:create' %}?vehiculo={{ vehiculo.pk }}">
          <i class="bi bi-calendar-plus me-1"></i> Nueva cita
        </a>
        {% if vehiculo.cliente %}
          <a class="btn btn-outline-light btn-sm" href="{% url 'clientes:detail' vehiculo.cliente.pk %}">
            <i class="bi bi-person-lines-fill me-1"></i> Ver cliente
          </a>
        {% endif %}
        <button class="btn btn-outline-light btn-sm copy-placa" type="button" data-copy="{{ vehiculo.placa }}">
          <i class="bi bi-clipboard"></i> Copiar placa
        </button>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 info-grid">
  <div class="col-lg-7">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body">
        <h2 class="h6 text-uppercase text-muted mb-3">Informacion tecnica</h2>
        <div class="row g-3">
          <div class="col-sm-6">
            <div class="p-3 bg-light rounded">
              <div class="text-muted small text-uppercase">Marca</div>
              <div class="fw-semibold fs-6">{{ vehiculo.marca|default:"-" }}</div>
            </div>
          </div>
          <div class="col-sm-6">
            <div class="p-3 bg-light rounded">
              <div class="text-muted small text-uppercase">Modelo</div>
              <div class="fw-semibold fs-6">{{ vehiculo.modelo|default:"-" }}</div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="p-3 bg-light rounded">
              <div class="text-muted small text-uppercase">Anio</div>
              <div class="fw-semibold fs-6">{{ vehiculo.anio|default:"-" }}</div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="p-3 bg-light rounded">
              <div class="text-muted small text-uppercase">Color</div>
              <div class="fw-semibold fs-6">{{ vehiculo.color|default:"-" }}</div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="p-3 bg-light rounded">
              <div class="text-muted small text-uppercase">Cliente</div>
              {% if vehiculo.cliente %}
                <div class="fw-semibold fs-6">
                  <a class="text-decoration-none" href="{% url 'clientes:detail' vehiculo.cliente.pk %}">
                    {{ vehiculo.cliente.nombre }}
                  </a>
                </div>
              {% else %}
                <div class="fw-semibold fs-6 text-muted">Sin asignar</div>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="mt-4">
          <div class="text-muted small mb-2">
            <i class="bi bi-clock-history me-1"></i>
            Creado el {{ vehiculo.creado|date:"Y-m-d H:i" }} &middot; Ultima actualizacion {{ vehiculo.actualizado|timesince }} ago
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body">
        <h2 class="h6 text-uppercase text-muted mb-3">Otros vehiculos del cliente</h2>
        {% if otros_vehiculos_cliente %}
          <div class="list-group list-group-flush">
            {% for item in otros_vehiculos_cliente %}
              <a class="list-group-item list-group-item-action d-flex justify-content-between" href="{% url 'vehiculos:detail' item.pk %}">
                <div>
                  <div class="fw-semibold text-uppercase">{{ item.placa }}</div>
                  <div class="text-muted small">{{ item.marca|default:"-" }} {{ item.modelo|default:"" }}</div>
                </div>
                <span class="badge text-bg-light">{{ item.anio|default:"-" }}</span>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted small mb-0">No hay otros vehiculos asociados al cliente.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mt-1">
  <div class="col-lg-7">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h6 text-uppercase text-muted mb-0">Citas recientes</h2>
          <a class="btn btn-link btn-sm text-decoration-none" href="{% url 'citas:list' %}?vehiculo={{ vehiculo.pk }}">
            Ver todas
          </a>
        </div>

        {% if citas_recientes %}
          <div class="list-group list-group-flush">
            {% for cita in citas_recientes %}
              <div class="list-group-item px-0">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <div class="fw-semibold">{{ cita.titulo }}</div>
                    <div class="text-muted small">
                      {{ cita.fecha_inicio|date:"Y-m-d H:i" }} &middot; {{ cita.servicio.nombre }}
                    </div>
                  </div>
                  <span class="badge text-bg-light text-uppercase small">
                    {{ cita.get_estado_display }}
                  </span>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-light mb-0" role="alert">
            No hay citas registradas para este vehiculo. Crea la primera para seguir su mantenimiento.
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h2 class="h6 text-uppercase text-muted mb-3">Notas rapidas</h2>
        <ul class="list-unstyled mb-0">
          <li class="mb-3 d-flex align-items-start">
            <span class="timeline-dot mt-1"></span>
            <span>Revisa la informacion del cliente antes de agendar una cita para este vehiculo.</span>
          </li>
          <li class="mb-3 d-flex align-items-start">
            <span class="timeline-dot mt-1"></span>
            <span>Utiliza el historial de citas para anticipar mantenimientos y repuestos.</span>
          </li>
          <li class="d-flex align-items-start">
            <span class="timeline-dot mt-1"></span>
            <span>Actualiza color o modelo cuando el cliente realice modificaciones relevantes.</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  const copyBtn = document.querySelector(".copy-placa");
  if (!copyBtn) {
    return;
  }
  copyBtn.addEventListener("click", function (event) {
    const value = event.currentTarget.getAttribute("data-copy");
    if (!value) {
      return;
    }
    navigator.clipboard.writeText(value).then(function () {
      const icon = event.currentTarget.querySelector("i");
      if (!icon) {
        return;
      }
      const original = icon.className;
      icon.className = "bi bi-clipboard-check";
      setTimeout(function () {
        icon.className = original;
      }, 1500);
    });
  });
});
</script>
{% endblock %}
